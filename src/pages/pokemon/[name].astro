---
import BaseLayout from "../../layouts/BaseLayout.astro";

// https://pokeapi.co/docs/v2
interface PokemonListResponse {
  results: { name: string; url: string }[];
}
interface PokemonDetail {
  name: string;
  height: number;
  weight: number;
  sprites?: { front_default?: string };
  types: { slot: number; type: { name: string } }[];
}

export async function getStaticPaths() {
  const res = await fetch("https://pokeapi.co/api/v2/pokemon?limit=10");
  const data = (await res.json()) as PokemonListResponse;
  return data.results.map((p) => ({ params: { name: p.name } }));
}

const { name } = Astro.params;
const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
if (!res.ok) {
  throw new Error(`Failed to load pokemon ${name}`);
}
const pokemon = (await res.json()) as PokemonDetail;

const title = "Pokémon — My Site";
const description = "detail page.";
---

<BaseLayout
  title={`${pokemon.name} — ${title}`}
  description={`Detail ${pokemon.name} — ${description}`}
>
  <div
    class="p-2 bg-sky-100 mb-4 shadow rounded inline-block border border-sky-600"
  >
    <a href="/pokemon">← Back</a>
  </div>

  <h1 class="border border-sky-600 p-4 bg-neutral-100 shadow rounded">
    {pokemon.name} — {title}
  </h1>
  <div class="custom-class">
    <span class="font-bold">{pokemon.name}</span>
    {description}
  </div>

  <div class="p-4 bg-white shadow rounded mt-4 border border-sky-600">
    <h1 class="text-2xl font-bold mb-2">
      {pokemon.name}
    </h1>
    <img src={pokemon.sprites?.front_default} alt={pokemon.name} class="mb-4" />
    <p>Height: {pokemon.height}</p>
    <p>Weight: {pokemon.weight}</p>
    <h2 class="mt-4 font-semibold">Types</h2>
    <ul>
      {pokemon.types.map((t) => <li>{t.type.name}</li>)}
    </ul>
  </div>
</BaseLayout>
