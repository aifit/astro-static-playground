---
import BaseLayout from "../../layouts/BaseLayout.astro";
import SEO from "../../components/SEO.astro";

// https://pokeapi.co/docs/v2
interface PokemonListResponse {
  results: { name: string; url: string }[];
}
interface PokemonDetail {
  name: string;
  height: number;
  weight: number;
  sprites?: { front_default?: string };
  types: { slot: number; type: { name: string } }[];
}

export async function getStaticPaths() {
  const res = await fetch("https://pokeapi.co/api/v2/pokemon?limit=20");
  const data = (await res.json()) as PokemonListResponse;
  return data.results.map((p) => ({ params: { name: p.name } }));
}

const { name } = Astro.params;
const res = await fetch(`https://pokeapi.co/api/v2/pokemon/${name}`);
if (!res.ok) {
  throw new Error(`Failed to load pokemon ${name}`);
}
const pokemon = (await res.json()) as PokemonDetail;
---

<BaseLayout
  title={`${pokemon.name} — Pokémon`}
  description={`Detail ${pokemon.name}`}
>
  <SEO
    title={`${pokemon.name} — Pokémon`}
    description={`Detail ${pokemon.name}`}
  />
  <main class="p-4">
    <a class="text-sm text-sky-600" href="/">← Back</a>
    <h1 class="text-3xl font-bold mt-4 mb-2">{pokemon.name}</h1>
    <img src={pokemon.sprites?.front_default} alt={pokemon.name} class="mb-4" />
    <p>Height: {pokemon.height}</p>
    <p>Weight: {pokemon.weight}</p>
    <h2 class="mt-4 font-semibold">Types</h2>
    <ul>
      {pokemon.types.map((t) => <li>{t.type.name}</li>)}
    </ul>
  </main>
</BaseLayout>
